// Define the data to be loaded
const chapterDataList = [
    {
        chapterTitle: "Chapter 1: Introduction",
        episodes: [
            {
                episodeNumber: 1,
                title: "1",
                mainText: "I was born in the year 1632, in the city of York, of a good family, though not of that country, my father being a foreigner of Bremen, who settled first at Hull. He got a good estate by merchandise, and leaving off his trade, lived afterwards at York, from whence he had married my mother, whose relations were named Robinson, a very good family in that country, and from whom I was called Robinson Kreutznaer; but, by the usual corruption of words in England, we are now called—nay we call ourselves and write our name—Crusoe; and so my companions always called me.",
                audioUrl: "https://drive.google.com/file/d/1y49sBz8ufE9I9wRHbJ3UZHK9ZF7rSZ9y/view?usp=share_link",
                imageUrl: "https://source.unsplash.com/random/800x600?nature"
            },
            {
                episodeNumber: 2,
                title: "2",
                mainText: "My father, a wise and grave man, gave me serious and excellent counsel against what he foresaw was my design. He called me one morning into his chamber, where he was confined by the gout, and expostulated very warmly with me upon this subject. He asked me what reasons, more than a mere wandering inclination, I had for leaving father’s house and my native country, where I might be well introduced, and had a prospect of raising my fortune by application and industry, with a life of ease and pleasure. He told me it was men of desperate fortunes on one hand, or of aspiring, superior fortunes on the other, who went abroad upon adventures, to rise by enterprise, and make themselves famous in undertakings of a nature out of the common road; that these things were all either too far above me or too far below me; that mine was the middle state, or what might be called the upper station of low life, which he had found, by long experience, was the best state in the world, the most suited to human happiness, not exposed to the miseries and hardships, the labour and sufferings of the mechanic part of mankind, and not embarrassed with the pride, luxury, ambition, and envy of the upper part of mankind. He told me I might judge of the happiness of this state by this one thing that this was the state of life which all other people envied; that kings have frequently lamented the miserable consequence of being born to great things, and wished they had been placed in the middle of the two extremes, between the mean and the great; that the wise man gave his testimony to this, as the standard of felicity, when he prayed to have neither poverty nor riches.",
                audioUrl: "https://drive.google.com/file/d/1wzcCemO3BkjONLa9NV08gQupQDV-V5kc/view?usp=share_link",
                imageUrl: "https://source.unsplash.com/random/800x600?water"
            },
            {
                episodeNumber: 3,
                title: "3",
                mainText: "He bade me observe it, and I should always find that the calamities of life were shared among the upper and lower part of mankind, but that the middle station had the fewest disasters, and was not exposed to so many vicissitudes as the higher or lower part of mankind; nay, they were not subjected to so many distempers and uneasinesses, either of body or mind, as those were who, by vicious living, luxury, and extravagances on the one hand, or by hard labour, want of necessaries, and mean or insufficient diet on the other hand, bring distemper upon themselves by the natural consequences of their way of living; that the middle station of life was calculated for all kind of virtue and all kind of enjoyments; that peace and plenty were the handmaids of a middle fortune; that temperance, moderation, quietness, health, society, all agreeable diversions, and all desirable pleasures, were the blessings attending the middle station of life; that this way men went silently and smoothly through the world, and comfortably out of it, not embarrassed with the labours of the hands or of the head, not sold to a life of slavery for daily bread, nor harassed with perplexed circumstances, which rob the soul of peace and the body of rest, nor enraged with the passion of envy, or the secret burning lust of ambition for great things; but, in easy circumstances, sliding gently through the world, and sensibly tasting the sweets of living, without the bitter; feeling that they are happy, and learning by every day’s experience to know it more sensibly.",
                audioUrl: "https://1drv.ms/u/s!AirUFl6stvfG4gnNjeGt7kfAD2BH?e=9Ulb4f",
                imageUrl: "https://source.unsplash.com/random/800x600?water"
            },
            // Add more episodes for Chapter 1 as needed
        ]
    },
    {
        chapterTitle: "Chapter 2: The Journey Begins",
        episodes: [
            {
                episodeNumber: 1,
                title: "1",
                mainText: "After this he pressed me earnestly, and in the most affectionate manner, not to play the young man, nor to precipitate myself into miseries which nature, and the station of life I was born in, seemed to have provided against; that I was under no necessity of seeking my bread; that he would do well for me, and endeavour to enter me fairly into the station of life which he had just been recommending to me; and that if I was not very easy and happy in the world, it must be my mere fate or fault that must hinder it; and that he should have nothing to answer for, having thus discharged his duty in warning me against measures which he knew would be to my hurt; in a word, that as he would do very kind things for me if I would stay and settle at home as he directed, so he would not have so much hand in my misfortunes as to give me any encouragement to go away; and to close all, he told me I had my elder brother for an example, to whom he had used the same earnest persuasions to keep him from going into the Low Country wars, but could not prevail, his young desires prompting him to run into the army, where he was killed; and though he said he would not cease to pray for me, yet he would venture to say to me, that if I did take this foolish step, God would not bless me, and I should have leisure hereafter to reflect upon having neglected his counsel when there might be none to assist in my recovery.",
                audioUrl: "https://1drv.ms/u/s!AirUFl6stvfG4goIr_T_f3GOVOgU?e=bqdNrc",
                imageUrl: "https://source.unsplash.com/random/800x600?mountain"
            },
            {
                episodeNumber: 2,
                title: "2",
                mainText: "Ut enim ad minima veniam, quis nostrum exercitationem ullamUt enim ad minima veniam, quis nostrum exercitationem ullam Ut enim ad minima veniam, quis nostrum exercitationem ullam Ut enim ad minima veniam, quis nostrum exercitationem ullam Ut enim ad minima veniam, quis nostrum exercitationem ullam",
                audioUrl: "https://example.com/audiofile2-2.mp3",
                imageUrl: "https://source.unsplash.com/random/800x600?forest"
            },
            {
                episodeNumber: 3,
                title: "3",
                mainText: "Ut qwewqeqe easdsa fdw访问团访问 strum exercitationem ullamUt enim ad minima veniam, quis nostrum exercitationem ullam Ut enim ad minima veniam, quis nostrum exercitationem ullam Ut enim ad minima veniam, quis nostrum exercitationem ullam Ut enim ad minima veniam, quis nostrum exercitationem ullam",
                audioUrl: "https://example.com/audiofile2-2.mp3",
                imageUrl: "https://source.unsplash.com/random/800x600?forest"
            },
        ]
    }
    // Add more chapters as needed
];

let currentChapterId = 0; // Starting with the first chapter
let currentEpisodeId = 0; // Starting with the first episode

function getNextChapterAndEpisodeId(currentChapterId, currentEpisodeId) {
    // Check if there's a next episode in the current chapter
    if (currentEpisodeId + 1 < chapterDataList[currentChapterId].episodes.length) {
        // Next episode is in the same chapter
        return {
            nextChapterId: currentChapterId,
            nextEpisodeId: currentEpisodeId + 1
        };
    } else if (currentChapterId + 1 < chapterDataList.length) {
        // Current episode is the last in the current chapter, move to the next chapter
        // Assuming the next chapter has at least one episode
        return {
            nextChapterId: currentChapterId + 1,
            nextEpisodeId: 0 // Start at the first episode of the next chapter
        };
    } else {
        // Current episode is the last in the last chapter, no next chapter or episode
        // Here, you could loop back to the start or indicate the end; depends on desired behavior
        // To indicate the end, returning null or similar could work:
        return null;
    }
}

function highlightActiveToCItem(chapterIndex, episodeIndex) {
    // Remove highlight from all ToC items
    document.querySelectorAll('.toc a').forEach(a => {
        a.classList.remove('active');
    });

    // Highlight the active ToC item
    const selector = `.toc a[data-chapter-id="${chapterIndex}"][data-episode-id="${episodeIndex}"]`;
    const activeItem = document.querySelector(selector);
    if (activeItem) {
        activeItem.classList.add('active');
    }
}

function loadEpisodeData(chapterIndex, episodeIndex) {
    let chapterData = chapterDataList[chapterIndex];
    let chapterTitle = chapterData.chapterTitle;
    let episodeData = chapterData.episodes[episodeIndex];
    // Update the content dynamically
    document.querySelector('.content h2').textContent = chapterTitle + " (" + episodeData.episodeNumber + ")";
    document.querySelector('main p').textContent = episodeData.mainText;
    document.querySelector('audio source').src = episodeData.audioUrl;
    document.querySelector('figure img').src = episodeData.imageUrl;

    // Reload the audio element to apply the new source
    document.querySelector('audio').load();
    document.querySelector('audio').play().catch(e => console.error("Autoplay was prevented.", e));

    currentChapterId = chapterIndex;
    currentEpisodeId = episodeIndex;
}

function goToNextEpisode() {
    const next = getNextChapterAndEpisodeId(currentChapterId, currentEpisodeId);
    if (next) {
        // Update currentChapterId and currentEpisodeId if moving to the next episode
        currentChapterId = next.nextChapterId;
        currentEpisodeId = next.nextEpisodeId;
        loadEpisodeData(currentChapterId, currentEpisodeId)
        highlightActiveToCItem(currentChapterId, currentEpisodeId);
    } 
}

document.addEventListener('DOMContentLoaded', function() {
    document.querySelector('#continueButton').addEventListener('click', (event) => {
        event.preventDefault();
        goToNextEpisode();
    });
});

document.addEventListener('DOMContentLoaded', function() {
    const toggleTocBtn = document.getElementById('toggleToc');
    const toc = document.getElementById('tableOfContents');
    const content = document.querySelector('.content');

    toggleTocBtn.addEventListener('click', function(event) {
        event.preventDefault(); // Prevent the link from navigating
        toc.classList.toggle('hidden'); // Toggle the visibility of the ToC

        if (toc.classList.contains('hidden')) {
            content.classList.remove('content-contracted');
            content.classList.add('content-expanded');
        } else {
            content.classList.remove('content-expanded');
            content.classList.add('content-contracted');
        }
    });
});

const bookName = "AAA"
const tocData = [
    {
        chapterTitle: "Chapter 3",
        episodes: ["Chapter 3 (1)", "Chapter 3 (2)", "Chapter 3 (3)"]
    },
    {
        chapterTitle: "Chapter 4",
        episodes: ["Chapter 4 (1)", "Chapter 4 (2)"]
    }
];

function loadTableOfContents(tocData) {
    const toc = document.getElementById('tableOfContents');
    toc.innerHTML = '<h2>'+bookName+'</h2>'; // Reset ToC content

    const ul = document.createElement('ul');

    tocData.forEach((chapter, chapterIndex) => {
        let chapterElem = document.createElement('li');
        chapterElem.textContent = chapter.chapterTitle;
        ul.appendChild(chapterElem);

        let episodesUl = document.createElement('ul');
        chapter.episodes.forEach((episode, episodeIndex) => {
            let episodeLi = document.createElement('li');
            let episodeLink = document.createElement('a');
            episodeLink.textContent = episode;
            // Use data attributes to store chapter and episode indices
            episodeLink.dataset.chapterId = chapterIndex;
            episodeLink.dataset.episodeId = episodeIndex;
            episodeLink.addEventListener('click', function(e) {
                e.preventDefault(); // Prevent default anchor behavior
                // Convert data attributes to numbers as they are stored as strings
                const chapterId = parseInt(this.dataset.chapterId, 10);
                const episodeId = parseInt(this.dataset.episodeId, 10);
                loadEpisodeData(chapterId, episodeId); // Call the episode loading function
                highlightActiveToCItem(chapterId, episodeId);
                // Optional: Implement highlighting logic here
            });
            episodeLi.appendChild(episodeLink);
            episodesUl.appendChild(episodeLi);
        });
        ul.appendChild(episodesUl);
    });

    toc.appendChild(ul);
}

document.addEventListener('DOMContentLoaded', function() {
    loadTableOfContents(tocData); // Populate ToC when the page loads
    loadEpisodeData(0,0);
    highlightActiveToCItem(0,0);
});


